FROM python:3.11-slim

WORKDIR /workspace

# Install Airflow with providers for validation
RUN pip install --no-cache-dir \
    "apache-airflow==3.1.0" \
    --constraint "https://raw.githubusercontent.com/apache/airflow/constraints-3.1.0/constraints-3.11.txt" && \
    pip install --no-cache-dir \
    apache-airflow-providers-cncf-kubernetes \
    apache-airflow-providers-amazon

# Copy validation script
COPY validate_dags.py /usr/local/bin/validate_dags.py
RUN chmod +x /usr/local/bin/validate_dags.py

ENTRYPOINT ["python", "/usr/local/bin/validate_dags.py"]
